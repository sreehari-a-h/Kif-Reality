{% extends 'base.html' %}

{% block title %}{{ property.title.en }} - KIF Realty{% endblock %}

{% load static %}
{% load custom_filters %}

{% block content %}
<style>
    :root {
        --primary-gold: #d7b56d;
        --light-gold: #f3e2b8;
        --dark-gold: #b8924a;
        --darker-gold: #9b7b35;
        --white: #ffffff;
        --light-gray: #f8f9fa;
        --dark: #2c2c2c;
        --shadow: rgba(0, 0, 0, 0.1);
        --gradient-primary: linear-gradient(135deg, var(--primary-gold), var(--dark-gold));
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Cinzel', serif;
        line-height: 1.6;
        color: var(--dark);
        background: var(--light-gray);
        overflow-x: hidden;
        padding-top: 80px;
    }

    /* Loading States */
    .loading-skeleton {
        background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
        background-size: 200% 100%;
        animation: loading 1.5s infinite;
    }

    @keyframes loading {
        0% {
            background-position: 200% 0;
        }

        100% {
            background-position: -200% 0;
        }
    }

    .error-state {
        background: #fee;
        border: 1px solid #fcc;
        color: #c33;
        padding: 1rem;
        border-radius: 8px;
        text-align: center;
    }

    /* Main Layout */
    .property-layout {
        display: grid;
        grid-template-columns: 1fr 400px;
        min-height: calc(100vh - 80px);
        gap: 0;
    }

    /* Left Panel */
    .left-panel {
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }

    /* Hero Section */
    .property-hero {
        position: relative;
        height: 400px;
        overflow: hidden;
        background: linear-gradient(135deg, rgba(0, 0, 0, 0.3), rgba(215, 181, 109, 0.3));
    }

    .hero-gallery {
        position: relative;
        width: 100%;
        height: 100%;
    }

    .hero-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: all 0.5s ease;
    }

    .gallery-nav {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        border: none;
        width: 45px;
        height: 45px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        z-index: 10;
        font-size: 1rem;
        opacity: 0.8;
    }

    .gallery-nav:hover {
        background: var(--primary-gold);
        color: white;
        transform: translateY(-50%) scale(1.1);
        opacity: 1;
    }

    .gallery-prev {
        left: 20px;
    }

    .gallery-next {
        right: 20px;
    }

    .gallery-indicators {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 8px;
        z-index: 10;
    }

    .gallery-indicator {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.5);
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .gallery-indicator.active {
        background: white;
        transform: scale(1.2);
    }

    .hero-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(45deg, rgba(0, 0, 0, 0.4), rgba(215, 181, 109, 0.2));
        padding: 2rem;
        color: white;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    .property-title {
        font-size: 2.5rem;
        font-weight: 900;
        margin-bottom: 0.8rem;
        color: white;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
        line-height: 1.2;
    }

    .property-location {
        font-size: 1.1rem;
        opacity: 0.95;
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
    }

    .price-badge {
        display: inline-block;
        background: var(--gradient-primary);
        color: white;
        padding: 1rem 2rem;
        border-radius: 25px;
        font-size: 1.2rem;
        font-weight: 700;
        box-shadow: 0 8px 20px rgba(215, 181, 109, 0.6);
        align-self: flex-start;
        text-shadow: none;
    }

    /* Content Container */
    .content-container {
        flex: 1;
        overflow-y: auto;
        background: white;
        padding: 2rem;
    }

    .content-container::-webkit-scrollbar {
        width: 6px;
    }

    .content-container::-webkit-scrollbar-track {
        background: var(--light-gray);
    }

    .content-container::-webkit-scrollbar-thumb {
        background: var(--primary-gold);
        border-radius: 3px;
    }

    /* Section Styles */
    .section {
        margin-bottom: 3rem;
        opacity: 0;
        transform: translateY(20px);
        transition: all 0.6s ease;
    }

    .section.animate-in {
        opacity: 1;
        transform: translateY(0);
    }

    .section-title {
        font-size: 1.5rem;
        font-weight: 800;
        color: var(--dark);
        margin-bottom: 1.5rem;
        padding-bottom: 0.8rem;
        border-bottom: 3px solid var(--primary-gold);
        position: relative;
        display: flex;
        align-items: center;
        gap: 0.8rem;
    }

    .section-title::after {
        content: '';
        position: absolute;
        bottom: -3px;
        left: 0;
        width: 60px;
        height: 3px;
        background: var(--darker-gold);
    }

    .section-title i {
        color: var(--primary-gold);
        font-size: 1.3rem;
    }

    .property-description {
        font-size: 1rem;
        line-height: 1.8;
        color: #555;
        margin-bottom: 2rem;
    }

    .property-description p {
        margin-bottom: 1rem;
    }

    .property-description p:last-child {
        margin-bottom: 0;
    }

    /* Property Stats */
    .property-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .stat-item {
        background: white;
        padding: 1.5rem;
        border-radius: 12px;
        text-align: center;
        border: 2px solid var(--light-gray);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
    }

    .stat-item::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
        transition: left 0.5s;
    }

    .stat-item:hover {
        border-color: var(--primary-gold);
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(215, 181, 109, 0.3);
    }

    .stat-item:hover::before {
        left: 100%;
    }

    .stat-icon {
        font-size: 2rem;
        color: var(--primary-gold);
        margin-bottom: 1rem;
        display: block;
    }

    .stat-value {
        font-size: 1.8rem;
        font-weight: 800;
        color: var(--dark);
        margin-bottom: 0.5rem;
        display: block;
    }

    .stat-label {
        color: #666;
        font-size: 0.9rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    /* Facilities Grid */
    .facilities-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
    }

    .facility-item {
        background: white;
        padding: 1.2rem;
        border-radius: 10px;
        display: flex;
        align-items: center;
        gap: 1rem;
        transition: all 0.3s ease;
        font-size: 1rem;
        border: 1px solid var(--light-gray);
        cursor: pointer;
    }

    .facility-item:hover {
        background: var(--primary-gold);
        color: white;
        transform: translateX(5px);
        box-shadow: 0 5px 15px rgba(215, 181, 109, 0.4);
    }

    .facility-icon {
        font-size: 1.3rem;
        color: var(--primary-gold);
        transition: all 0.3s ease;
        width: 20px;
        text-align: center;
        flex-shrink: 0;
    }

    .facility-item:hover .facility-icon {
        color: white;
        transform: scale(1.2);
    }

    /* Units Grid */
    .units-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
    }

    .unit-card {
        background: white;
        border-radius: 15px;
        padding: 1.8rem;
        border: 2px solid var(--light-gray);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: pointer;
        position: relative;
        overflow: hidden;
    }

    .unit-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 4px;
        background: var(--gradient-primary);
        transition: left 0.4s ease;
    }

    .unit-card:hover {
        border-color: var(--primary-gold);
        background: white;
        transform: translateY(-8px);
        box-shadow: 0 15px 35px rgba(215, 181, 109, 0.3);
    }

    .unit-card:hover::before {
        left: 0;
    }

    .unit-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--light-gray);
    }

    .unit-type {
        font-size: 1.3rem;
        font-weight: 800;
        color: var(--dark);
    }

    .unit-price {
        background: var(--gradient-primary);
        color: white;
        padding: 0.8rem 1.5rem;
        border-radius: 20px;
        font-weight: 700;
        font-size: 1rem;
        text-shadow: none;
    }

    .unit-details {
        display: grid;
        grid-template-columns: 1fr 1fr auto;
        gap: 1rem;
        align-items: center;
    }

    .unit-detail {
        text-align: center;
        padding: 1rem;
        background: var(--light-gray);
        border-radius: 8px;
        transition: all 0.3s ease;
    }

    .unit-card:hover .unit-detail {
        background: rgba(215, 181, 109, 0.1);
    }

    .unit-detail-value {
        font-size: 1.2rem;
        font-weight: 700;
        color: var(--primary-gold);
        margin-bottom: 0.3rem;
        display: block;
    }

    .unit-detail-label {
        color: #666;
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .unit-action {
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: var(--primary-gold);
        transition: all 0.3s ease;
    }

    .unit-card:hover .unit-action {
        transform: translateX(5px);
        color: var(--darker-gold);
    }

    /* Right Sidebar */
    .sidebar {
        background: white;
        display: flex;
        flex-direction: column;
        border-left: 1px solid #e9ecef;
        overflow-y: auto;
    }

    .sidebar::-webkit-scrollbar {
        width: 6px;
    }

    .sidebar::-webkit-scrollbar-track {
        background: var(--light-gray);
    }

    .sidebar::-webkit-scrollbar-thumb {
        background: var(--primary-gold);
        border-radius: 3px;
    }

    .sidebar-card {
        padding: 2rem;
        border-bottom: 1px solid #e9ecef;
        transition: all 0.3s ease;
    }

    .sidebar-card:last-child {
        border-bottom: none;
    }

    .sidebar-card:hover {
        background: rgba(215, 181, 109, 0.02);
    }

    /* Contact Card */
    .contact-card {
        text-align: center;
        background: linear-gradient(135deg, rgba(215, 181, 109, 0.05), rgba(215, 181, 109, 0.1));
    }

    .agent-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        margin: 0 auto 1.5rem;
        background: var(--gradient-primary);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        color: white;
        box-shadow: 0 8px 20px rgba(215, 181, 109, 0.4);
    }

    .agent-name {
        font-size: 1.3rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
        color: var(--dark);
    }

    .agent-title {
        color: #666;
        margin-bottom: 1.5rem;
        font-size: 1rem;
    }

    .contact-btn {
        background: var(--gradient-primary);
        color: white;
        padding: 12px 24px;
        border: none;
        border-radius: 25px;
        font-weight: 600;
        cursor: pointer;
        width: 100%;
        margin-bottom: 1rem;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.8rem;
        text-decoration: none;
        font-size: 1rem;
        position: relative;
        overflow: hidden;
    }

    .contact-btn::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        transition: all 0.3s ease;
        transform: translate(-50%, -50%);
    }

    .contact-btn:hover::before {
        width: 300px;
        height: 300px;
    }

    .contact-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(215, 181, 109, 0.6);
        color: white;
    }

    .contact-btn.outline {
        background: transparent;
        color: var(--primary-gold);
        border: 2px solid var(--primary-gold);
    }

    .contact-btn.outline:hover {
        background: var(--primary-gold);
        color: white;
    }

    /* Info Cards */
    .info-card-title {
        font-size: 1.2rem;
        font-weight: 700;
        margin-bottom: 1.5rem;
        color: var(--dark);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .info-card-title i {
        color: var(--primary-gold);
    }

    .plan-details {
        display: grid;
        gap: 0.8rem;
    }

    .plan-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.8rem 0;
        border-bottom: 1px solid #eee;
        font-size: 0.95rem;
        transition: all 0.3s ease;
    }

    .plan-item:last-child {
        border-bottom: none;
    }

    .plan-item:hover {
        padding-left: 10px;
        background: rgba(215, 181, 109, 0.05);
        margin: 0 -10px;
        border-radius: 5px;
    }

    .plan-item strong {
        color: var(--primary-gold);
        font-weight: 700;
    }

    /* Payment Plans */
    .payment-plan {
        background: linear-gradient(135deg, var(--light-gray), white);
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        border: 1px solid #eee;
        transition: all 0.3s ease;
    }

    .payment-plan:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .plan-name {
        font-size: 1.1rem;
        font-weight: 700;
        margin-bottom: 1rem;
        color: white;
        text-align: center;
        padding: 0.5rem;
        background: var(--gradient-primary);
        border-radius: 8px;
    }

    /* Location Section */
    .location-content {
        text-align: center;
        padding: 2rem;
        background: linear-gradient(135deg, var(--light-gray), white);
        border-radius: 12px;
    }

    .location-icon {
        font-size: 3rem;
        color: var(--primary-gold);
        margin-bottom: 1rem;
    }

    .location-title {
        color: var(--dark);
        margin-bottom: 1rem;
        font-size: 1.5rem;
        font-weight: 700;
    }

    .location-description {
        color: #666;
        line-height: 1.6;
        margin-bottom: 1.5rem;
    }

    .location-btn {
        background: var(--gradient-primary);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 20px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .location-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(215, 181, 109, 0.4);
    }

    /* Quick Actions */
    .quick-actions {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: var(--gradient-primary);
        padding: 15px 30px;
        border-radius: 30px;
        display: flex;
        gap: 20px;
        box-shadow: 0 10px 30px rgba(215, 181, 109, 0.6);
        z-index: 1000;
        backdrop-filter: blur(10px);
    }

    .quick-action {
        color: white;
        text-decoration: none;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        border-radius: 20px;
        transition: all 0.3s ease;
        font-size: 0.9rem;
    }

    .quick-action:hover {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        transform: translateY(-2px);
    }

    .navbar {
            position: fixed;
            top: 0;
            width: 100%;
            background: #F5F5DC;
            backdrop-filter: blur(15px);
            padding: 1rem 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            transition: all 0.3s ease;
            box-shadow: 0 2px 30px rgba(0, 0, 0, 0.1);
        }

        .navbar span {
            background: linear-gradient(165deg,
                    var(--primary-gold),
                    var(--medium-gold),
                    var(--primary-gold));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .navbar.scrolled {
            background: #F5F5DC;
            backdrop-filter: blur(20px);
            box-shadow: 0 4px 40px rgba(0, 0, 0, 0.15);
            padding: 0.8rem 5%;
        }

    /* Mobile Responsive Design */
    @media (max-width: 1024px) {
        .property-layout {
            grid-template-columns: 1fr 350px;
        }

        .property-stats {
            grid-template-columns: repeat(2, 1fr);
        }

        .facilities-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @media (max-width: 768px) {
        body {
            padding-top: 70px;
        }

        .property-layout {
            grid-template-columns: 1fr;
            min-height: calc(100vh - 70px);
        }

        .left-panel {
            order: 1;
        }

        .sidebar {
            order: 2;
            border-left: none;
            border-top: 1px solid #e9ecef;
        }

        .property-hero {
            height: 300px;
        }

        .hero-overlay {
            padding: 1.5rem;
        }

        .property-title {
            font-size: 2rem;
        }

        .price-badge {
            font-size: 1rem;
            padding: 0.8rem 1.5rem;
        }

        .content-container {
            padding: 1.5rem;
        }

        .section {
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 1.3rem;
        }

        .property-stats {
            grid-template-columns: 1fr;
            gap: 1rem;
        }

        .facilities-grid {
            grid-template-columns: 1fr;
        }

        .units-grid {
            grid-template-columns: 1fr;
        }

        .unit-details {
            grid-template-columns: 1fr 1fr 60px;
        }

        .sidebar-card {
            padding: 1.5rem;
        }

        .quick-actions {
            bottom: 10px;
            padding: 12px 20px;
            gap: 15px;
        }

        .quick-action {
            font-size: 0.85rem;
        }
    }

    @media (max-width: 480px) {
        .property-hero {
            height: 250px;
        }

        .hero-overlay {
            padding: 1rem;
        }

        .property-title {
            font-size: 1.6rem;
        }

        .content-container {
            padding: 1rem;
        }

        .stat-item {
            padding: 1rem;
        }

        .stat-icon {
            font-size: 1.5rem;
        }

        .stat-value {
            font-size: 1.4rem;
        }

        .unit-card {
            padding: 1.2rem;
        }

        .agent-avatar {
            width: 60px;
            height: 60px;
            font-size: 1.5rem;
        }
    }

    /* Animation Classes */
    .fade-in {
        animation: fadeIn 0.6s ease-in;
    }

    .slide-up {
        animation: slideUp 0.6s ease-out;
    }

    .bounce-in {
        animation: bounceIn 0.8s ease-out;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes bounceIn {
        0% {
            opacity: 0;
            transform: scale(0.3);
        }

        50% {
            opacity: 1;
            transform: scale(1.05);
        }

        70% {
            transform: scale(0.9);
        }

        100% {
            opacity: 1;
            transform: scale(1);
        }
    }

    /* Print Styles */
    @media print {

        .quick-actions,
        .gallery-nav,
        .gallery-indicators {
            display: none;
        }

        .property-layout {
            grid-template-columns: 1fr;
        }

        .property-hero {
            height: 200px;
        }
    }
</style>

<!-- Main Layout -->
<div class="property-layout" id="propertyLayout">
    <!-- Left Panel -->
    <div class="left-panel">
        <!-- Hero Section -->
        <section class="property-hero">
            <div class="hero-gallery">
                <img id="heroImage" src="{{ property.cover }}" alt="{{ property.title.en }}" class="hero-image">

                {% if property.property_images|length > 0 %}
                <button class="gallery-nav gallery-prev" onclick="changeImage(-1)">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <button class="gallery-nav gallery-next" onclick="changeImage(1)">
                    <i class="fas fa-chevron-right"></i>
                </button>

                <div class="gallery-indicators" id="galleryIndicators">
                    <div class="gallery-indicator active"></div>
                    {% for image in property.property_images %}
                    <div class="gallery-indicator"></div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>

            <div class="hero-overlay">
                <h1 class="property-title">{{ property.title.en }}</h1>
                <div class="property-location">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>{{ property.district.name.en }}, {{ property.city.name.en }}</span>
                </div>
                <div class="price-badge">
                    From {{ property.low_price|floatformat:0|add_commas }} AED
                </div>
            </div>
        </section>

        <!-- Content Container -->
        <div class="content-container">
            <!-- Overview Section -->
            <div class="section fade-in" id="overviewSection">
                <h2 class="section-title">
                    <i class="fas fa-home"></i>
                    About This Property
                </h2>
                <div class="property-description">
                    {{ property.description.en|safe }}
                </div>
            </div>

            <!-- Details Section -->
            <div class="section slide-up" id="detailsSection">
                <h2 class="section-title">
                    <i class="fas fa-info-circle"></i>
                    Property Details
                </h2>
                <div class="property-stats">
                    <div class="stat-item">
                        <i class="stat-icon fas fa-building"></i>
                        <div class="stat-value">{{ property.residential_units }}</div>
                        <div class="stat-label">Units</div>
                    </div>
                    <div class="stat-item">
                        <i class="stat-icon fas fa-calendar"></i>
                        <div class="stat-value">{{ property.delivery_date|date:"Y" }}</div>
                        <div class="stat-label">Delivery</div>
                    </div>
                    <div class="stat-item">
                        <i class="stat-icon fas fa-percentage"></i>
                        <div class="stat-value">{{ property.completion_rate }}%</div>
                        <div class="stat-label">Complete</div>
                    </div>
                    <div class="stat-item">
                        <i class="stat-icon fas fa-expand-arrows-alt"></i>
                        <div class="stat-value">{{ property.min_area|floatformat:0 }}</div>
                        <div class="stat-label">Min sq ft</div>
                    </div>
                </div>
            </div>

            <!-- Amenities Section -->
            {% if property.facilities %}
            <div class="section bounce-in" id="amenitiesSection">
                <h2 class="section-title">
                    <i class="fas fa-star"></i>
                    Amenities & Facilities
                </h2>
                <div class="facilities-grid">
                    {% for facility in property.facilities %}
                    <div class="facility-item">
                        <div class="facility-icon">
                            {% if "Swimming" in facility.name.en or "Pool" in facility.name.en %}
                            <i class="fas fa-swimming-pool"></i>
                            {% elif "Gym" in facility.name.en or "Fitness" in facility.name.en %}
                            <i class="fas fa-dumbbell"></i>
                            {% elif "Garden" in facility.name.en or "Park" in facility.name.en %}
                            <i class="fas fa-leaf"></i>
                            {% elif "BBQ" in facility.name.en %}
                            <i class="fas fa-fire"></i>
                            {% elif "Parking" in facility.name.en or "Garage" in facility.name.en %}
                            <i class="fas fa-car"></i>
                            {% elif "Jogging" in facility.name.en or "Track" in facility.name.en %}
                            <i class="fas fa-running"></i>
                            {% elif "Yoga" in facility.name.en or "Spa" in facility.name.en %}
                            <i class="fas fa-peace"></i>
                            {% elif "Playground" in facility.name.en or "Kids" in facility.name.en %}
                            <i class="fas fa-child"></i>
                            {% elif "Security" in facility.name.en %}
                            <i class="fas fa-shield-alt"></i>
                            {% elif "Business" in facility.name.en %}
                            <i class="fas fa-briefcase"></i>
                            {% elif "Retail" in facility.name.en or "Shop" in facility.name.en %}
                            <i class="fas fa-store"></i>
                            {% else %}
                            <i class="fas fa-star"></i>
                            {% endif %}
                        </div>
                        <span>{{ facility.name.en }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Units Section -->
            {% if property.grouped_apartments %}
            <div class="section fade-in" id="unitsSection">
                <h2 class="section-title">
                    <i class="fas fa-building"></i>
                    Available Units
                </h2>
                <div class="units-grid">
                    {% for unit in property.grouped_apartments %}
                        <div class="unit-card" onclick="navigateToUnit('{{ property.id }}', '{{ unit.id }}')">
                            <div class="unit-header">
                                <div class="unit-type">
                                    {{ unit.unit_type.en }} - {{ unit.rooms.en }}{% if unit.rooms.en != "Studio" %}BR{% endif %}
                                </div>
                                <div class="unit-price">
                                    {{ unit.min_price|floatformat:0|add_commas }} AED
                                </div>
                            </div>
                            <div class="unit-details">
                                <div class="unit-detail">
                                    <div class="unit-detail-value">{{ unit.min_area|floatformat:0 }}</div>
                                    <div class="unit-detail-label">sq ft</div>
                                </div>
                                <div class="unit-detail">
                                    <div class="unit-detail-value">{{ unit.rooms.en }}</div>
                                    <div class="unit-detail-label">
                                        {% if unit.rooms.en == "Studio" %}
                                            Studio
                                        {% else %}
                                            BR
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="unit-action">
                                    <i class="fas fa-arrow-right"></i>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Location Section -->
            <div class="section slide-up" id="locationSection">
                <div class="section slide-up" id="locationSection">
                    <h2 class="section-title">
                        <i class="fas fa-map-marker-alt"></i>
                        Location & Nearby
                    </h2>
                    <div class="location-content">
                        <i class="fas fa-map-marked-alt location-icon"></i>
                        <h3 class="location-title">Prime Location</h3>
                        <p class="location-description">
                            Located in {{ property.district.name.en }}, one of Dubai's most sought-after neighborhoods,
                            this property offers excellent connectivity to major landmarks, business districts, and
                            leisure destinations.
                            Experience the perfect blend of urban convenience and luxurious living.
                        </p>

                        <button onclick="toggleMap()" class="location-btn">
                            <i class="fas fa-map"></i> View on Map
                        </button>

                        <!-- Hidden Map Container -->
                        <div id="mapContainer" style="display:none; height:400px; width:100%; margin-top:15px;">
                            {% if property.latitude and property.longitude %}
                            <iframe
                                src="https://maps.google.com/maps?q={{ property.latitude }},{{ property.longitude }}&z=15&output=embed"
                                width="100%" height="100%" style="border:0;" allowfullscreen loading="lazy"
                                referrerpolicy="no-referrer-when-downgrade">
                            </iframe>
                            {% else %}
                            <iframe
                                src="https://maps.google.com/maps?q={{ property.district.name.en|urlencode }}&z=15&output=embed"
                                width="100%" height="100%" style="border:0;" allowfullscreen loading="lazy"
                                referrerpolicy="no-referrer-when-downgrade">
                            </iframe>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <script>
                    function toggleMap() {
                        const mapContainer = document.getElementById("mapContainer");
                        mapContainer.style.display = (mapContainer.style.display === "none" || mapContainer.style.display === "")
                            ? "block"
                            : "none";
                    }
                </script>


            </div>
        </div>
    </div>

        <!-- Right Sidebar -->
        <div class="sidebar">
            <!-- Contact Card -->
            <div class="sidebar-card contact-card">
                <div class="agent-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <h3 class="agent-name">Property Consultant</h3>
                <p class="agent-title">{{ property.developer.name }} Representative</p>

                <a href="tel:+971509647864" class="contact-btn">
                    <i class="fas fa-phone"></i>
                    Call Now
                </a>
                <a href="https://wa.me/971509647864" class="contact-btn outline" target="_blank">
                    <i class="fab fa-whatsapp"></i>
                    WhatsApp
                </a>
            </div>

            <!-- Quick Info -->
            <div class="sidebar-card">
                <h3 class="info-card-title">
                    <i class="fas fa-info-circle"></i>
                    Quick Info
                </h3>
                <div class="plan-details">
                    <div class="plan-item">
                        <span>Type</span>
                        <strong>Residential</strong>
                    </div>
                    <div class="plan-item">
                        <span>Developer</span>
                        <strong>{{ property.developer.name }}</strong>
                    </div>
                    <div class="plan-item">
                        <span>Status</span>
                        <strong>{{ property.sales_status.name.en }}</strong>
                    </div>
                    <div class="plan-item">
                        <span>Handover</span>
                        <strong>{{ property.delivery_date|date:"M Y" }}</strong>
                    </div>
                    {% if property.min_area and property.max_area %}
                    <div class="plan-item">
                        <span>Built-up Area</span>
                        <strong>{{ property.min_area|floatformat:0 }} - {{ property.max_area|floatformat:0 }} sq
                            ft</strong>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Payment Plans -->
            <div class="sidebar-card">
                <h3 class="info-card-title">
                    <i class="fas fa-credit-card"></i>
                    Payment Plans
                </h3>
                {% if property.payment_plans %}
                {% for plan in property.payment_plans %}
                <div class="payment-plan">
                    <div class="plan-name">{{ plan.name.en }}</div>
                    <div class="plan-details">
                        {% for value in plan.values %}
                        <div class="plan-item">
                            <span>{{ value.values.en }}</span>
                            <strong>{{ value.value }}</strong>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
                {% else %}
                <div class="payment-plan">
                    <div class="plan-name">Standard Plan</div>
                    <div class="plan-details">
                        <div class="plan-item">
                            <span>Down Payment</span>
                            <strong>20%</strong>
                        </div>
                        <div class="plan-item">
                            <span>During Construction</span>
                            <strong>60%</strong>
                        </div>
                        <div class="plan-item">
                            <span>On Handover</span>
                            <strong>20%</strong>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>

            <!-- Location Highlights -->
            <div class="sidebar-card">
                <h3 class="info-card-title">
                    <i class="fas fa-map"></i>
                    Location Highlights
                </h3>
                <div class="plan-details">
                    <div class="plan-item">
                        <span>Dubai Mall</span>
                        <strong>15 min</strong>
                    </div>
                    <div class="plan-item">
                        <span>Burj Khalifa</span>
                        <strong>12 min</strong>
                    </div>
                    <div class="plan-item">
                        <span>Dubai Airport</span>
                        <strong>25 min</strong>
                    </div>
                    <div class="plan-item">
                        <span>Beach Access</span>
                        <strong>5 min walk</strong>
                    </div>
                    <div class="plan-item">
                        <span>Metro Station</span>
                        <strong>8 min walk</strong>
                    </div>
                </div>
            </div>

            <!-- Developer Info -->
            <div class="sidebar-card">
                <h3 class="info-card-title">
                    <i class="fas fa-building"></i>
                    Developer
                </h3>
                <div style="text-align: center;">
                    <h4 style="color: var(--primary-gold); margin-bottom: 0.5rem;">{{ property.developer.name }}</h4>
                    <p style="color: #666; font-size: 0.9rem; line-height: 1.5;">
                        {% if property.developer.description %}
                        {{ property.developer.description }}
                        {% else %}
                        Trusted developer with years of experience in creating exceptional properties in Dubai's prime
                        locations.
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <!-- <div class="quick-actions">
    <a href="tel:+971509647864" class="quick-action">
        <i class="fas fa-phone"></i>
        Call
    </a>
    <a href="https://wa.me/971509647864" class="quick-action" target="_blank">
        <i class="fab fa-whatsapp"></i>
        WhatsApp
    </a>
    <a href="#" class="quick-action" onclick="requestBrochure()">
        <i class="fas fa-download"></i>
        Brochure
    </a>
    <a href="#" class="quick-action" onclick="scheduleViewing()">
        <i class="fas fa-calendar"></i>
        Visit
    </a>
</div> -->

    <script>
        // Image gallery functionality
        let currentImageIndex = 0;
        const images = [
            "{{ property.cover }}"{% for image in property.property_images %},
        "{{ image.image }}"
        {% endfor %}
    ];

        function changeImage(direction) {
            if (images.length <= 1) return;

            const heroImage = document.getElementById('heroImage');
            const indicators = document.querySelectorAll('.gallery-indicator');

            currentImageIndex += direction;

            if (currentImageIndex >= images.length) currentImageIndex = 0;
            else if (currentImageIndex < 0) currentImageIndex = images.length - 1;

            // Update image with smooth transition
            heroImage.style.opacity = '0.7';
            heroImage.style.transform = 'scale(1.05)';

            setTimeout(() => {
                heroImage.src = images[currentImageIndex];
                heroImage.style.opacity = '1';
                heroImage.style.transform = 'scale(1)';
            }, 200);

            // Update indicators
            indicators.forEach((indicator, index) => {
                indicator.classList.toggle('active', index === currentImageIndex);
            });

            // Reset autoplay
            resetGalleryAutoplay();
        }

        // Auto-play gallery
        let galleryInterval;
        function startGalleryAutoplay() {
            if (images.length > 1) {
                galleryInterval = setInterval(() => {
                    changeImage(1);
                }, 4000);
            }
        }

        function resetGalleryAutoplay() {
            clearInterval(galleryInterval);
            startGalleryAutoplay();
        }

        // Navigate to unit page
        function navigateToUnit(propertyId, unitId) {
            window.location.href = `/property/${propertyId}/unit/${unitId}/`;
        }

        // Event Handlers
        function requestBrochure() {
            const btn = event.target.closest('.quick-action');
            const originalHTML = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';

            setTimeout(() => {
                btn.innerHTML = '<i class="fas fa-check"></i> Sent!';
                setTimeout(() => {
                    btn.innerHTML = originalHTML;
                }, 2000);
            }, 1500);
        }

        function scheduleViewing() {
            const btn = event.target.closest('.quick-action');
            const originalHTML = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Booking...';

            setTimeout(() => {
                btn.innerHTML = '<i class="fas fa-check"></i> Booked!';
                setTimeout(() => {
                    btn.innerHTML = originalHTML;
                }, 2000);
            }, 1500);
        }

        function showLocationMap() {
            // Placeholder for map functionality
            alert('Map integration will be implemented with Google Maps or similar service.');
        }

        // Initialize animations
        function initializeAnimations() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('animate-in');
                    }
                });
            }, { threshold: 0.1, rootMargin: '0px 0px -50px 0px' });

            document.querySelectorAll('.section').forEach(section => {
                observer.observe(section);
            });
        }

        // Touch gestures for mobile
        function initializeTouchGestures() {
            if (!('ontouchstart' in window)) return;

            let startX = 0;
            let startTime = 0;

            const heroGallery = document.querySelector('.hero-gallery');

            heroGallery.addEventListener('touchstart', function (e) {
                startX = e.touches[0].clientX;
                startTime = Date.now();
            }, { passive: true });

            heroGallery.addEventListener('touchend', function (e) {
                const endX = e.changedTouches[0].clientX;
                const timeDiff = Date.now() - startTime;
                const distance = Math.abs(startX - endX);

                if (timeDiff < 500 && distance > 50) {
                    if (startX - endX > 0) {
                        changeImage(1); // Swipe left - next image
                    } else {
                        changeImage(-1); // Swipe right - previous image
                    }
                }
            }, { passive: true });
        }

        // Contact button interactions
        function initializeContactButtons() {
            document.querySelectorAll('.contact-btn').forEach(btn => {
                btn.addEventListener('click', function (e) {
                    const icon = this.querySelector('i');
                    if (icon && !icon.classList.contains('fa-spin')) {
                        const originalClass = icon.className;
                        icon.className = 'fas fa-spinner fa-spin';
                        setTimeout(() => {
                            icon.className = originalClass;
                        }, 2000);
                    }
                });
            });
        }

        // Enhanced unit card interactions
        function initializeUnitCards() {
            const unitCards = document.querySelectorAll('.unit-card');
            unitCards.forEach(card => {
                card.addEventListener('mouseenter', function () {
                    this.style.transform = 'translateY(-10px) scale(1.02)';
                });

                card.addEventListener('mouseleave', function () {
                    this.style.transform = 'translateY(0) scale(1)';
                });
            });
        }

        // Parallax effect for hero image (subtle)
        function initializeParallaxEffect() {
            if (window.innerWidth > 768) {
                const heroImage = document.getElementById('heroImage');
                const hero = document.querySelector('.property-hero');

                hero.addEventListener('mousemove', function (e) {
                    const rect = hero.getBoundingClientRect();
                    const x = (e.clientX - rect.left) / rect.width;
                    const y = (e.clientY - rect.top) / rect.height;

                    heroImage.style.transform = `scale(1.05) translate(${(x - 0.5) * 20}px, ${(y - 0.5) * 20}px)`;
                });

                hero.addEventListener('mouseleave', function () {
                    heroImage.style.transform = 'scale(1) translate(0, 0)';
                });
            }
        }

        // Page visibility handling for performance
        function initializePageVisibility() {
            document.addEventListener('visibilitychange', function () {
                if (document.hidden) {
                    clearInterval(galleryInterval);
                } else {
                    if (images.length > 1) {
                        startGalleryAutoplay();
                    }
                }
            });
        }

        // Keyboard navigation
        function initializeKeyboardNavigation() {
            document.addEventListener('keydown', function (e) {
                if (e.key === 'ArrowLeft' && images.length > 1) {
                    changeImage(-1);
                } else if (e.key === 'ArrowRight' && images.length > 1) {
                    changeImage(1);
                }
            });
        }

        // Error handling for images
        function initializeImageErrorHandling() {
            const heroImage = document.getElementById('heroImage');
            heroImage.addEventListener('error', function () {
                this.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjYwMCIgdmlld0JveD0iMCAwIDgwMCA2MDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI4MDAiIGhlaWdodD0iNjAwIiBmaWxsPSIjZjhmOWZhIi8+CjxyZWN0IHg9IjM1MCIgeT0iMjUwIiB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI2Q3YjU2ZCIgcng9IjUwIi8+CjwvU3ZnPgo=';
            });
        }

        // Smooth scrolling performance optimization
        function initializeOptimizedScrolling() {
            let ticking = false;
            function updateScrollElements() {
                // Add any scroll-based animations or updates here
                ticking = false;
            }

            function requestTick() {
                if (!ticking) {
                    requestAnimationFrame(updateScrollElements);
                    ticking = true;
                }
            }

            // Smooth scrolling for content areas
            document.querySelectorAll('.content-container, .sidebar').forEach(container => {
                container.addEventListener('scroll', requestTick);
            });
        }

        // Initialize everything when DOM is loaded
        document.addEventListener('DOMContentLoaded', function () {
            console.log('Initializing enhanced property page...');

            // Initialize all components
            initializeAnimations();
            initializeTouchGestures();
            initializeContactButtons();
            initializeUnitCards();
            initializeParallaxEffect();
            initializePageVisibility();
            initializeKeyboardNavigation();
            initializeImageErrorHandling();
            initializeOptimizedScrolling();

            // Start gallery autoplay if there are multiple images
            if (images.length > 1) {
                startGalleryAutoplay();
            }

            // Stagger loading animations for sections
            const sections = document.querySelectorAll('.section');
            sections.forEach((section, index) => {
                setTimeout(() => {
                    section.classList.add('animate-in');
                }, index * 200);
            });

            // Handle window resize
            let resizeTimer;
            window.addEventListener('resize', function () {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(() => {
                    // Handle any resize-specific logic here
                    console.log('Window resized - adjusting layout');
                }, 250);
            });

            console.log('Enhanced property page initialization complete');
        });

        // Add custom context menu prevention for images
        document.getElementById('heroImage').addEventListener('contextmenu', function (e) {
            e.preventDefault();
        });

        // Preload images for smooth gallery transitions
        if (images.length > 1) {
            images.forEach(src => {
                const img = new Image();
                img.src = src;
            });
        }

        // Add structured data for SEO
        const structuredData = {
            "@context": "https://schema.org",
            "@type": "RealEstate",
            "name": "{{ property.title.en }}",
            "description": "{{ property.description.en|striptags|truncatechars:160 }}",
            "image": "{{ property.cover }}",
            "address": {
                "@type": "PostalAddress",
                "addressLocality": "{{ property.city.name.en }}",
                "addressRegion": "{{ property.district.name.en }}"
            },
            "offers": {
                "@type": "Offer",
                "price": "{{ property.low_price }}",
                "priceCurrency": "AED"
            }
        };

        // Add meta tags for social sharing
        const metaTags = [
            { property: 'og:title', content: '{{ property.title.en }}' },
            { property: 'og:description', content: '{{ property.description.en|striptags|truncatechars:160 }}' },
            { property: 'og:image', content: '{{ property.cover }}' },
            { property: 'og:type', content: 'website' },
            { name: 'twitter:card', content: 'summary_large_image' },
            { name: 'twitter:title', content: '{{ property.title.en }}' },
            { name: 'twitter:description', content: '{{ property.description.en|striptags|truncatechars:160 }}' },
            { name: 'twitter:image', content: '{{ property.cover }}' }
        ];

        // Inject structured data and meta tags
        window.addEventListener('load', function () {
            const script = document.createElement('script');
            script.type = 'application/ld+json';
            script.textContent = JSON.stringify(structuredData);
            document.head.appendChild(script);

            metaTags.forEach(tag => {
                const meta = document.createElement('meta');
                if (tag.property) meta.setAttribute('property', tag.property);
                if (tag.name) meta.setAttribute('name', tag.name);
                meta.setAttribute('content', tag.content);
                document.head.appendChild(meta);
            });
        });
    </script>

    {% endblock %}